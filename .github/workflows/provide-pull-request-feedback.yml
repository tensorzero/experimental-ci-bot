name: Provide Pull Request Feedback to CI Bot

on:
  pull_request:
    types: [closed]

permissions:
  contents: read
  pull-requests: read
  actions: read

jobs:
  create-pr-feedback:
    runs-on: ubuntu-latest
    name: Create PR Feedback
    steps:
      - name: Connect to Tailscale
        uses: tailscale/github-action@v4
        with:
          oauth-client-id: ${{ secrets.CI_BOT_TS_OAUTH_CLIENT_ID }}
          oauth-secret: ${{ secrets.CI_BOT_TS_OAUTH_CLIENT_SECRET }}
          tags: tag:ci

      - name: Send PR Feedback
        # TODO: currently pinned to miniswe-agent branch; switch back to main when ready.
        uses: tensorzero/experimental-ci-bot/create-pr-feedback@viraj/pr-only
        with:
          tensorzero-base-url: http://localhost:3000
          # TODO: Switch to tensorzero_github_ci_bot_agent_pr_merged for episode-level feedback when agent creates PRs
          tensorzero-pr-merged-metric-name: tensorzero_github_ci_bot_pr_merged
          clickhouse-url: ${{ secrets.CI_BOT_CLICKHOUSE_URL }}
          clickhouse-table: GitHubBotPullRequestToInferenceMap
